name: Publish to Hashnode
on: push

jobs:
 publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v1
        with:
          node-version: '12.x'
      - run: npm install node-fetch
      - name: Check if PR was merged
        id: check-pr
        run: |
          if echo "${{ github.event.head_commit.message }}" | grep -q 'Merge pull request'; then
            echo "::set-output name=isMerged::true"
          else
            echo "::set-output name=isMerged::false"
          fi
      - name: Publish blog post
        if: steps.check-pr.outputs.isMerged == 'true'
        run: node blog.js
        env:
          HASHNODE_API_KEY: ${{ secrets.HASHNODE_API_KEY }}



const fetch = require('node-fetch');

const mutation = `
mutation ($input: CreatePostInput!) {
 createPost(input: $input) {
    post {
      slug
    }
 }
}`;


const variables = {
    input: {
       title: 'Your Blog Title',
       contentMarkdown: '# Your Blog Content\n\nThis is a blog post.',
       // Add any other fields you need
    },
   };

   
   fetch('https://gql.hashnode.com/', {
    method: 'POST',
    headers: {
       'Content-Type': 'application/json',
       'Authorization': `Bearer ${process.env.HASHNODE_API_KEY}`,
    },
    body: JSON.stringify({
       query: mutation,
       variables: variables,
    }),
   })
   .then(response => response.json())
   .then(data => console.log(data))
   .catch(error => console.error(error));
   